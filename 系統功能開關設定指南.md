# 🔧 系統功能開關設定指南

## ✅ 新增功能

現在你可以在 Google Sheet 中**控制系統各項功能是否啟用**，無需修改代碼！

---

## 📊 Google Sheet 設置

### **新增頁簽：系統設定**

在你的 Google Sheet 中新增一個頁簽，命名為：**系統設定**

### **設置表格結構**

第一行（標題行）：
```
功能名稱 | 是否啟用
```

第二行開始填入數據：

| 功能名稱 | 是否啟用 |
|---------|---------|
| saveToSheet | 是 |
| sendPromoterEmail | 是 |
| sendCustomerEmail | 是 |
| enableCache | 是 |
| logDetails | 是 |

---

## 🎛️ 功能說明

### **1. saveToSheet**（保存到 Google Sheet）
- **作用**：控制是否將客戶資料保存到 `Global` 表
- **設為「是」**：所有報名資料會自動保存到 Google Sheet
- **設為「否」**：不保存資料（僅發送郵件）
- **建議**：保持啟用（是）

### **2. sendPromoterEmail**（發送推廣人員郵件）
- **作用**：控制是否發送通知郵件給推廣人員
- **設為「是」**：推廣人員會收到新客戶報名通知
- **設為「否」**：不發送通知給推廣人員
- **建議**：保持啟用（是）

### **3. sendCustomerEmail**（發送客戶確認郵件）
- **作用**：控制是否發送確認郵件給報名客戶
- **設為「是」**：客戶會收到確認郵件和 LINE 群組連結
- **設為「否」**：不發送確認郵件給客戶
- **建議**：保持啟用（是）

### **4. enableCache**（啟用緩存）
- **作用**：控制是否使用緩存來加速郵箱映射表的讀取
- **設為「是」**：使用 10 分鐘緩存（更快，但更新推廣人員後需等 10 分鐘）
- **設為「否」**：每次都重新讀取（較慢，但立即生效）
- **建議**：正常運行時啟用，測試時可以禁用

### **5. logDetails**（記錄詳細日誌）
- **作用**：控制是否在執行記錄中顯示詳細的客戶資料
- **設為「是」**：記錄詳細日誌（方便調試）
- **設為「否」**：只記錄基本信息（保護隱私）
- **建議**：開發測試時啟用，正式運行時可禁用

---

## 📝 填寫規則

### **是否啟用**欄位可以填：

✅ **代表啟用（True）：**
- `是`
- `YES`
- `yes`
- `true`
- `TRUE`
- `1`

❌ **代表禁用（False）：**
- `否`
- `NO`
- `no`
- `false`
- `FALSE`
- `0`
- 留空

### **範例設置**

#### **正式運行建議配置：**
```
功能名稱              | 是否啟用
saveToSheet          | 是
sendPromoterEmail    | 是
sendCustomerEmail    | 是
enableCache          | 是
logDetails           | 否
```

#### **測試開發建議配置：**
```
功能名稱              | 是否啟用
saveToSheet          | 是
sendPromoterEmail    | 否
sendCustomerEmail    | 否
enableCache          | 否
logDetails           | 是
```

#### **僅收集資料不發郵件：**
```
功能名稱              | 是否啟用
saveToSheet          | 是
sendPromoterEmail    | 否
sendCustomerEmail    | 否
enableCache          | 是
logDetails           | 否
```

---

## 🔄 更新配置後的生效時間

- ✅ **立即生效**：保存後下一次表單提交就會使用新配置
- ⚠️ **緩存相關**：如果 `enableCache` 從「是」改為「否」，立即生效
- ⏱️ **郵箱映射表**：如果啟用了緩存，更新推廣人員郵箱後需要等待最多 10 分鐘

### **如何立即清除緩存？**

1. 打開 Google Apps Script 編輯器
2. 選擇函數：`clearCache`
3. 點擊「執行」
4. 緩存會立即清除

---

## 🧪 測試步驟

### **測試方法 1：禁用所有郵件**
1. 設置：
   ```
   sendPromoterEmail = 否
   sendCustomerEmail = 否
   ```
2. 提交測試表單
3. 檢查：
   - ✅ Google Sheet 有新資料
   - ✅ 沒有收到任何郵件
   - ✅ 執行記錄顯示「已禁用」

### **測試方法 2：只測試客戶郵件**
1. 設置：
   ```
   sendPromoterEmail = 否
   sendCustomerEmail = 是
   ```
2. 提交測試表單（用自己的郵箱）
3. 檢查：
   - ✅ 只有客戶收到確認郵件
   - ✅ 推廣人員沒有收到通知

### **測試方法 3：查看詳細日誌**
1. 設置：
   ```
   logDetails = 是
   ```
2. 提交測試表單
3. 在 Apps Script 查看「執行記錄」
4. 應該看到詳細的客戶資料日誌

---

## 🚨 常見使用場景

### **場景 1：系統維護期間**
**需求**：暫停所有功能，不處理新報名

**設置**：
```
saveToSheet = 否
sendPromoterEmail = 否
sendCustomerEmail = 否
```

### **場景 2：郵箱測試**
**需求**：測試郵件內容和格式

**設置**：
```
saveToSheet = 否          ← 不保存測試數據
sendPromoterEmail = 是    ← 發送測試郵件
sendCustomerEmail = 是
enableCache = 否          ← 立即讀取最新配置
logDetails = 是           ← 查看詳細日誌
```

### **場景 3：活動結束**
**需求**：停止接受新報名

**方法 1**：禁用所有功能
```
saveToSheet = 否
sendPromoterEmail = 否
sendCustomerEmail = 否
```

**方法 2**：在網站關閉報名表單（更好）

### **場景 4：只收集資料，稍後批量處理**
**需求**：先收集資料，稍後再聯繫客戶

**設置**：
```
saveToSheet = 是          ← 保存資料
sendPromoterEmail = 否    ← 暫不通知
sendCustomerEmail = 否    ← 暫不發確認郵件
```

稍後想通知時，可以：
1. 從 Sheet 中匯出客戶郵箱
2. 手動發送郵件
3. 或重新啟用郵件功能

---

## ⚠️ 重要注意事項

### **1. 頁簽名稱必須正確**
- 頁簽名稱必須是：**系統設定**（不能有空格或其他字符）
- 如果頁簽不存在，系統會使用默認配置（全部啟用）

### **2. 功能名稱必須正確**
- 功能名稱必須完全匹配：
  - `saveToSheet`
  - `sendPromoterEmail`
  - `sendCustomerEmail`
  - `enableCache`
  - `logDetails`
- 大小寫敏感！

### **3. 默認配置**
如果 Google Sheet 中找不到「系統設定」頁簽，會使用以下默認配置：
```javascript
saveToSheet: true              // 保存到 Sheet
sendPromoterEmail: true        // 發送推廣人員郵件
sendCustomerEmail: true        // 發送客戶確認郵件
enableCache: true              // 啟用緩存
logDetails: true               // 記錄詳細日誌
```

### **4. 測試完記得恢復**
測試完成後，記得將配置改回正式運行狀態！

---

## 🔍 查看執行狀態

### **如何確認配置是否生效？**

1. 打開 Google Apps Script 編輯器
2. 點擊左側「執行作業」
3. 選擇最近的執行記錄
4. 查看日誌，應該會看到：
   ```
   🔧 系統配置: {"saveToSheet":true,"sendPromoterEmail":true,...}
   ```

### **如何查看是否因配置而跳過某功能？**

查看日誌中是否有：
- `⚠️ 保存到 Sheet 功能已禁用`
- `⚠️ 推廣人員郵件通知已禁用`
- `⚠️ 客戶確認郵件已禁用`

---

## 📞 疑難排查

### **問題：配置沒有生效**
**解決方法**：
1. 確認頁簽名稱是「系統設定」
2. 確認功能名稱拼寫正確
3. 確認「是否啟用」欄位填的是「是」或「否」
4. 查看執行記錄中的系統配置

### **問題：郵箱映射表更新不生效**
**解決方法**：
1. 設置 `enableCache = 否`
2. 或執行 `clearCache` 函數
3. 或等待 10 分鐘讓緩存自動過期

### **問題：找不到「系統設定」頁簽**
**解決方法**：
1. 在 Google Sheet 中新增頁簽
2. 命名為「系統設定」
3. 按照上面的表格結構設置

---

## 🎉 好處

使用功能開關的好處：
1. ✅ **靈活控制**：隨時開關功能，無需修改代碼
2. ✅ **方便測試**：測試時可以禁用郵件，避免發送測試郵件給客戶
3. ✅ **快速維護**：維護期間可以暫停所有功能
4. ✅ **階段部署**：可以先收集資料，稍後再啟用郵件功能
5. ✅ **保護隱私**：正式運行時可以禁用詳細日誌

---

更新時間：2024-11-20

祝您使用順利！🚀

